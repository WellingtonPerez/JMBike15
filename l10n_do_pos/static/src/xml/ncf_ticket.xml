<?xml version="1.0" encoding="UTF-8"?>
<templates id="template">
    <t t-name="OrderReceipt" t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension" owl="1">

        <xpath expr="//div[hasclass('pos-receipt')]" position="replace">
            <div class="pos-receipt">
                <t t-set="sale_fiscal_data"
                   t-value="env.pos.get_sale_fiscal_type()"/>
            
                <t t-if='receipt.company.logo'>
                    <img style="width: 30%;display: block;margin: auto;" t-att-src='receipt.company.logo' alt="Logo"/>
                    <br/>
                </t>

                    <div style="font-size: 100%; text-align:center;">
                        <t t-if='!receipt.company.logo'>
                            <div style="font-weight: bolder !important;" class="pos-receipt-center-align">
                               <strong><t t-esc='receipt.company.name'/></strong>
                            </div>
                        </t>
                        <t t-if='receipt.company.contact_address'>
                            <div><t t-esc='receipt.company.contact_address' /></div>
                        </t>
                        <t t-if='receipt.company.phone'>
                            <div>Tel:<t t-esc='receipt.company.phone' /></div>
                        </t>

                        <t t-if='receipt.company.vat'>
                            <div> <t t-esc='receipt.company.vat' /></div>
                        </t>
                        <t t-if='receipt.company.website'>
                            <div><t t-esc='receipt.company.website' /></div>
                        </t>
                      
                        <t t-if='receipt.header_html'>
                            <t t-raw='receipt.header_html' />
                        </t>
                        <t t-if='!receipt.header_html and receipt.header'>
                            <div><t t-esc='receipt.header' /></div>
                        </t>
                        <br/>
                        <t t-if="receipt.return_order_id">
                            <span>Nota de Crédito</span>
                            <br/>
                        </t>
                        <t t-else="">
                            <span><strong>Factura de
                                <t t-esc="sale_fiscal_data.sale_fiscal_type"/></strong>
                            </span>
                            <br/>
                        </t>
                        <span style="font-size:15px;"><strong>NCF:</strong>
                            <t t-esc="sale_fiscal_data.ncf"/>
                        </span> 
                        <br/>

                        <t t-if="receipt.return_order_id">
                            <br/>
                            <span>NCF Modificado:
                                <t t-esc="receipt.origin_ncf"/>
                            </span>
                        </t>
                        <br/>
                       <span style="font-size:15px;"><strong> NCF Vence:</strong> 31/12/2023</span>
                        <br/>
                        <br/>
                    </div>

                    <!-- Orderlines -->
                    <div class="orderlines">
                        <div style="text-align:center; font-size: 75%; border-top: 1px dashed black;border-bottom: 1px dashed black;padding-top: 5px;padding-bottom: 5px;">
                            <div style="font-size:13px;"><strong>Recibido :</strong> <span t-esc='receipt.name' /></div>
                            <br/>
                            <div style="font-size:13px;"><strong>Fecha :</strong> 
                                <t t-if="receipt.date.localestring">
                                  <span t-esc='receipt.date.localestring' />
                                </t>
                                <t t-else="">
                                    <span t-esc='receipt.date.localestring' />
                                </t>
                            </div>

                            <br/>
                            <t t-if='receipt.client'>
                                <div style="font-size:15px;"><strong>Cliente :</strong><t t-esc='receipt.client.name' /></div>
                                <div style="font-size:15px;"><strong>RNC/Céd..:</strong><t t-esc="receipt.client.vat"/></div>
                                <br/>
                            
                            <br/>
                            </t>
                            <t t-if='receipt.cashier'>
                            <div class='cashier' style="font-size:15px;">
                                <strong>Servido por:</strong><t t-esc='receipt.cashier' />
                            </div>
                            </t>
                            
                            <br/>
                            <br/>
                            <div style="border-top: 1px dashed black;margin-top: -21px;"/>
                            <br/>
                            <table style="width: 100%;">
                                <tr style="border-bottom: 2px solid black;font-size:15px;">
                                <th style="text-align:left;">Producto</th>
                                <th>Cant</th>
                                <th style="text-align: center;">Precio Unitario</th>
                                <th>Monto</th>
                                </tr>
                                
                               <tr t-foreach="receipt.orderlines" t-as="line" style="border-bottom: 1px solid #ddd;font-size: 16px;font-family: initial; font-size: 18px;">
                                <td><div style="padding-top: 10px;padding-bottom: 10px;">
                                    <div style="text-align: left;"><t t-esc='line.product_name_wrapped[0]'/></div>
                                    <t t-if='line.discount !== 0'>
                                        <h5 style="margin-top: 0%;margin-bottom: 0%;font-size: 12px;color: #848484;">
                                            <t t-esc='line.discount' />% Descuento 
                                        </h5>
                                    </t>
                                    </div>
                                </td>
                                <td style="text-align: center;"><span t-esc="line.quantity"/> <span t-if='line.unit_name !== "Units"' t-esc='line.unit_name'/></td>
                                <td style="text-align: center;"><span t-esc="env.pos.format_currency_no_symbol(line.price)"/></td>
                                <td style="text-align: center;"><span t-esc='env.pos.format_currency_no_symbol(line.price_display)'/></td>
                            </tr>
                             </table>                     
                        </div>
                    </div>  

                    <!-- Subtotal -->
                    <t t-set='taxincluded' t-value='Math.abs(receipt.subtotal - receipt.total_with_tax) &lt;= 0.000001' />
                    <t t-if='!taxincluded'>
                        <br/> 
                        <div style="font-weight: 700;text-align: right; border-top: 2px solid;margin-left: 30%; padding-top: 2%;">Subtotal : <span t-esc='env.pos.format_currency(receipt.subtotal)' class="pos-receipt-right-align"/></div>
                        <br/>
                        <t t-foreach='receipt.tax_details' t-as='tax'>
                            <div style="font-size: 20px; font-weight: 700;text-align: right;">
                                <t t-esc='tax.name' />
                                <span t-esc='env.pos.format_currency_no_symbol(tax.amount)' class="pos-receipt-right-align"/>
                                <br/>
                            </div>
                        </t>
                    </t>
                    <!-- Total -->
                    <br/>
                    <div style="text-align: right;font-weight: 700; border-top: 2px solid;margin-left: 30%;padding-top: 2%;">
                        TOTAL :
                        <span t-esc='env.pos.format_currency(receipt.total_with_tax)'/>
                    </div>
                    <br/>  

                      <!-- Extra Payment Info -->
                <t t-if='receipt.total_discount'>
                    <div style="font-size: 14px;text-align: right;border-top: 1px solid;margin-left: 30%;padding-top: 2%;">
                        Descuentos
                        <span t-esc='env.pos.format_currency(receipt.total_discount)'/>
                    </div>
                </t>
                <br/>
                <t t-if='taxincluded'>
                    <t t-foreach='receipt.tax_details' t-as='tax'>
                        <div style="font-size: 15px; text-align: right; font-weight: 700; border-top: 1px solid;margin-left: 30%;padding-top: 2%;">
                            <t t-esc='tax.name' />
                            <span t-esc='env.pos.format_currency_no_symbol(tax.amount)'/>
                        </div>
                    </t>
                    <div style="font-size: 15px; text-align: right; font-weight: 700;">
                        Total Impuesto :
                        <span t-esc='env.pos.format_currency(receipt.total_tax)'/>
                    </div>
                </t>
                <br/>
                <br/>
                <div style="border-top: 1px dashed black;padding-top: 5%;border-bottom: 1px dashed black;">
                    <!-- Payment Lines -->
                    <t t-foreach='paymentlines' t-as='line'>
                        <div style="font-size: 14px;">
                            <t t-esc='line.name' />
                            <span t-esc='env.pos.format_currency_no_symbol(line.get_amount())' class="pos-receipt-right-align"/>
                        </div>
                    </t>
                    <br/>
                    <div class="receipt-change" style="font-size: 14px;">
                        CAMBIO
                        <span t-esc='env.pos.format_currency(receipt.change)' class="pos-receipt-right-align"/>
                    </div>
                    <br/>
                </div>  

                <div class='before-footer' />
                <!-- Footer -->
                <div t-if='receipt.footer_html'  class="pos-receipt-center-align" style="font-size: 14px;">
                    <t t-raw='receipt.footer_html'/>
                </div>
                <div t-if='!receipt.footer_html and receipt.footer'  class="pos-receipt-center-align" style="font-size: 13px;">
                    <br/>
                    <t t-esc='receipt.footer'/>
                    <br/>
                    <br/>
                </div>
                <div class='after-footer' style="font-size: 14px;">
                    <t t-foreach='paymentlines' t-as='line'>
                        <t t-if='line.ticket'>
                            <br />
                            <div class="pos-payment-terminal-receipt">
                                <t t-raw='line.ticket'/>
                            </div>
                        </t>
                    </t>
                </div>
                <br/>
                <div style="text-align:center;font-size: 120%;">
                    <t t-if='receipt.table'>
                     <b>Mesa: <t t-esc="env.pos.table.name"/></b>
                    </t> 
                </div>  
            </div>       
        </xpath>

    </t>
</templates>
